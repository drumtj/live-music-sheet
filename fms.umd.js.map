{"version":3,"sources":["webpack://FMS/webpack/universalModuleDefinition","webpack://FMS/webpack/bootstrap","webpack://FMS/./lib/fms.ts"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","createPlayData","data","Tone","Time","toSeconds","map","track","rr","forEach","node","info","startTime","ndata","note","x","parseFloat","undefined","push","time","beat","parseInt","notes","durations","Math","floor","sort","a","b","schedule","playData","callback","console","error","events","Part","noteInfo","VF","noteToMidiMap","C0","C#0","D0","D#0","E0","F0","F#0","G0","G#0","A0","A#0","B0","C1","C#1","D1","D#1","E1","F1","F#1","G1","G#1","A1","A#1","B1","C2","C#2","D2","D#2","E2","F2","F#2","G2","G#2","A2","A#2","B2","C3","C#3","D3","D#3","E3","F3","F#3","G3","G#3","A3","A#3","B3","C4","C#4","D4","D#4","E4","F4","F#4","G4","G#4","A4","A#4","B4","C5","C#5","D5","D#5","E5","F5","F#5","G5","G#5","A5","A#5","B5","C6","C#6","D6","D#6","E6","F6","F#6","G6","G#6","A6","A#6","B6","C7","C#7","D7","D#7","E7","F7","F#7","G7","G#7","A7","A#7","B7","C8","C#8","D8","D#8","E8","F8","F#8","G8","G#8","A8","A#8","B8","C9","keyMap","C","bass","G","D","A","E","B","F#","C#","F","Bb","Eb","Ab","Db","Gb","Cb","Em","Bm","F#m","C#m","G#m","D#m","A#m","Dm","Gm","Cm","Fm","Bbm","Ebm","Abm","scoreTable","1","score","dot","b64","b16","2","3","4","6","7","8","12","14","16","24","28","32","48","56","64","96","112","sortNote","desc","convertKey","indexOf","dkeyScoreTable","keys","reduce","scoreIndex64b","sil","length","fillRed","fillStyle","strokeStyle","fillBlack","checkBarBeat","Array","isArray","duration","Error","beatSum1","beatSum2","replace","isNaN","b64ToDurations","rest","b64Split","subCount","noteParseExp","noteToVFFormat","match","accidental","noteToVFFormat2","ac","accidentals","charCount","str","result","REST_NOTE_KEY","b64ToDuration","makeRestNoteInfoSplitRest","offset","subOffset","rn","endB64","isRest","fixedRest","tieTail","tieHead","createStaveNote","keyDiff","sn","StaveNote","auto_stem","addAccidental","Accidental","addDotToAll","convertToVexFlowData","tdata","ti","line","ni","bi","bars","round","bar","concat","voice","voices","lastNote","vi","voiceIndex","li","prevB64","prevLength","tempArr","newVoice","apply","_toConsumableArray","sliceB64","nextBar","nextVoice","unshift","b64Offset","arr","assign","yfix","_newVoice","_newVoice2","offsetEnd","drawNotation","vexflowData","options","startBarNum","partGap","bpm","noteC","topMargin","trackLength","leftMargin","measureWidth","groupGap","el","document","firstChild","removeChild","renderer","Renderer","tagName","Backends","CANVAS","SVG","context","getContext","setFont","setBackgroundFillStyle","staveNote","voiceMax","barMax","lineMax","beamsList","stavesList","tiesList","resize","ceil","staves","ties","StaveTie","first_note","last_note","first_indices","last_indices","Voice","num_beats","beat_value","addTickables","setMode","Mode","SOFT","_loop","stave","Stave","addClef","addKeySignature","addTimeSignature","setText","StaveModifier","Position","LEFT","shift_x","shift_y","_isStartMeasure","setTempo","setContext","draw","Beam","applyAndGetBeams","Formatter","joinVoices","formatToStave","connectorList","sc","StaveConnector","setType","type","BRACE","beams","beam","voiceList","redraw","j","clear","clearDrawNote","_el","parentElement","drawNote","style","openGroup","getAttribute","setStyle","pointerBBox","hasStem","drawStem","flag","drawFlag","drawNoteHeads","closeGroup","drawModifiers","clearDrawBeam","drawBeam","setFillStyle","setStrokeStyle","drawBeamLines","clearDrawBeamStem","_beamStem_el","drawBeamStem","stem","drawNoteOn","just","_highlighted","drawNoteOff","noteOnList","t64","clearNoteOnList","isOn","noteOff","noteOn","id","e","defaultDrawOption","lineList","nodeLength","ctx","sync","createSync","scrollContainer","scroll","setLineList","scrollOffset","scrollDuration","scrollToStave","con","staveY","scrollTop","innerHeight","scrollTo","opt","startNote","currentStave","isScrolling","part","Draw","_stopped","y","offPart","start","this","at","stop","cancel","list","removeAll","add","Date","now","random","loader","max","each","done","_list","_each","_done","load","src","xhr","XMLHttpRequest","open","onreadystatechange","readyState","status","eval","responseText","loadComplete","send","loadAndInit","version","init","msg","progressText","createNSElement","attr","parant","createElementNS","setAttribute","appendChild","fill","setTimeout","textContent","synth","totalTime","parts","btn","highlight","isReady","endScheduleId","tick","play","activeColor","Transport","state","deactiveColor","Vex","Flow","Soundfont","instrument","_context","then","piano","last","maxDu","getTotalTime","g","width","height","txt","addEventListener","setColor","color","createPlayBtn"],"mappings":"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,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,MAAOC,KAAQ,CAAC,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,MAAOC,EAAK,CAAC,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,OAAQC,EAAK,CAAC,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,OAAQC,EAAK,CAAC,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,OAAQC,EAAK,CAAC,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,OAAQC,EAAK,CAAC,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,OAAQC,KAAM,CAAC,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAOC,KAAM,CAAC,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,MAAOC,EAAK,CAAC,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,MAAOC,GAAM,CAAC,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,MAAOC,GAAM,CAAC,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,MAAOC,GAAM,CAAC,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,MAAOC,GAAM,CAAC,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,MAAOC,GAAM,CAAC,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAOC,GAAM,CAAC,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,OAAQC,GAAM,CAAC,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,OAAQC,GAAM,CAAC,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,OAAQC,MAAO,CAAC,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,OAAQC,MAAO,CAAC,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,OAAQC,MAAO,CAAC,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,OAAQC,MAAO,CAAC,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAOC,MAAO,CAAC,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,MAAOC,GAAM,CAAC,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,MAAOC,GAAM,CAAC,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,MAAOC,GAAM,CAAC,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,MAAOC,GAAM,CAAC,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,MAAOC,IAAO,CAAC,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,MAAOC,IAAO,CAAC,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAOC,IAAO,CAAC,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,KAAM,MAAO,KAAM,MAAO,KAAM,KAAM,MAAO,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","file":"./fms.umd.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"FMS\"] = factory();\n\telse\n\t\troot[\"FMS\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","function createPlayData(data) {\r\n    let t = Tone.Time(\"16n\").toSeconds();\r\n    return data.data.map(function (track) {\r\n        let rr = [];\r\n        track.data.forEach(function (node, i) {\r\n            if (!node)\r\n                return;\r\n            let r = [];\r\n            let startTime = i * 32 * t;\r\n            let ndata = node.data;\r\n            for (let note in ndata) {\r\n                for (let x in ndata[note]) {\r\n                    if (parseFloat(x) >= 32)\r\n                        continue;\r\n                    if (r[x] == undefined)\r\n                        r[x] = [[], []];\r\n                    r[x][0].push(note);\r\n                    r[x][1].push(ndata[note][x]);\r\n                }\r\n            }\r\n            let info;\r\n            for (let time in r) {\r\n                if (r[time]) {\r\n                    info = { beat: parseInt(time) };\r\n                    info.notes = r[time][0];\r\n                    info.durations = r[time][1].map(l => Math.floor(l * t * 10000) / 10000);\r\n                    rr.push([Math.floor((parseFloat(time) * t + startTime) * 10000) / 10000, info]);\r\n                }\r\n            }\r\n        });\r\n        return rr.sort((a, b) => a[0] > b[0] ? 1 : -1);\r\n    });\r\n}\r\nfunction schedule(playData, callback) {\r\n    console.error(\"start schedule\");\r\n    return playData.map(events => {\r\n        return new Tone.Part((time, noteInfo) => {\r\n            if (noteInfo.notes) {\r\n                callback(noteInfo, time);\r\n            }\r\n        }, events);\r\n    });\r\n}\r\nvar VF;\r\nconst noteToMidiMap = { \"C0\": 0, \"C#0\": 1, \"D0\": 2, \"D#0\": 3, \"E0\": 4, \"F0\": 5, \"F#0\": 6, \"G0\": 7, \"G#0\": 8, \"A0\": 9, \"A#0\": 10, \"B0\": 11, \"C1\": 12, \"C#1\": 13, \"D1\": 14, \"D#1\": 15, \"E1\": 16, \"F1\": 17, \"F#1\": 18, \"G1\": 19, \"G#1\": 20, \"A1\": 21, \"A#1\": 22, \"B1\": 23, \"C2\": 24, \"C#2\": 25, \"D2\": 26, \"D#2\": 27, \"E2\": 28, \"F2\": 29, \"F#2\": 30, \"G2\": 31, \"G#2\": 32, \"A2\": 33, \"A#2\": 34, \"B2\": 35, \"C3\": 36, \"C#3\": 37, \"D3\": 38, \"D#3\": 39, \"E3\": 40, \"F3\": 41, \"F#3\": 42, \"G3\": 43, \"G#3\": 44, \"A3\": 45, \"A#3\": 46, \"B3\": 47, \"C4\": 48, \"C#4\": 49, \"D4\": 50, \"D#4\": 51, \"E4\": 52, \"F4\": 53, \"F#4\": 54, \"G4\": 55, \"G#4\": 56, \"A4\": 57, \"A#4\": 58, \"B4\": 59, \"C5\": 60, \"C#5\": 61, \"D5\": 62, \"D#5\": 63, \"E5\": 64, \"F5\": 65, \"F#5\": 66, \"G5\": 67, \"G#5\": 68, \"A5\": 69, \"A#5\": 70, \"B5\": 71, \"C6\": 72, \"C#6\": 73, \"D6\": 74, \"D#6\": 75, \"E6\": 76, \"F6\": 77, \"F#6\": 78, \"G6\": 79, \"G#6\": 80, \"A6\": 81, \"A#6\": 82, \"B6\": 83, \"C7\": 84, \"C#7\": 85, \"D7\": 86, \"D#7\": 87, \"E7\": 88, \"F7\": 89, \"F#7\": 90, \"G7\": 91, \"G#7\": 92, \"A7\": 93, \"A#7\": 94, \"B7\": 95, \"C8\": 96, \"C#8\": 97, \"D8\": 98, \"D#8\": 99, \"E8\": 100, \"F8\": 101, \"F#8\": 102, \"G8\": 103, \"G#8\": 104, \"A8\": 105, \"A#8\": 106, \"B8\": 107, \"C9\": 108 };\r\nconst keyMap = { \"C\": [\"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\", \"A8\", \"A#8\", \"B8\"], \"bass\": [\"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\", \"A8\"], \"G\": [\"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\"], \"D\": [\"D0\", \"D#0\", \"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\"], \"A\": [\"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\"], \"E\": [\"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\"], \"B\": [\"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\", \"A8\", \"A#8\"], \"F#\": [\"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\"], \"C#\": [\"C#0\", \"D0\", \"D#0\", \"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\"], \"F\": [\"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\"], \"Bb\": [\"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\", \"A8\"], \"Eb\": [\"D#0\", \"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\"], \"Ab\": [\"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\"], \"Db\": [\"C#0\", \"D0\", \"D#0\", \"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\"], \"Gb\": [\"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\"], \"Cb\": [\"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\", \"A8\", \"A#8\"], \"Em\": [\"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\"], \"Bm\": [\"D0\", \"D#0\", \"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\"], \"F#m\": [\"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\"], \"C#m\": [\"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\"], \"G#m\": [\"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\", \"A8\", \"A#8\"], \"D#m\": [\"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\"], \"A#m\": [\"C#0\", \"D0\", \"D#0\", \"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\"], \"Dm\": [\"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\"], \"Gm\": [\"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\", \"A8\"], \"Cm\": [\"D#0\", \"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\"], \"Fm\": [\"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\"], \"Bbm\": [\"C#0\", \"D0\", \"D#0\", \"E0\", \"F0\", \"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\"], \"Ebm\": [\"F#0\", \"G0\", \"G#0\", \"A0\", \"A#0\", \"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\"], \"Abm\": [\"B0\", \"C1\", \"C#1\", \"D1\", \"D#1\", \"E1\", \"F1\", \"F#1\", \"G1\", \"G#1\", \"A1\", \"A#1\", \"B1\", \"C2\", \"C#2\", \"D2\", \"D#2\", \"E2\", \"F2\", \"F#2\", \"G2\", \"G#2\", \"A2\", \"A#2\", \"B2\", \"C3\", \"C#3\", \"D3\", \"D#3\", \"E3\", \"F3\", \"F#3\", \"G3\", \"G#3\", \"A3\", \"A#3\", \"B3\", \"C4\", \"C#4\", \"D4\", \"D#4\", \"E4\", \"F4\", \"F#4\", \"G4\", \"G#4\", \"A4\", \"A#4\", \"B4\", \"C5\", \"C#5\", \"D5\", \"D#5\", \"E5\", \"F5\", \"F#5\", \"G5\", \"G#5\", \"A5\", \"A#5\", \"B5\", \"C6\", \"C#6\", \"D6\", \"D#6\", \"E6\", \"F6\", \"F#6\", \"G6\", \"G#6\", \"A6\", \"A#6\", \"B6\", \"C7\", \"C#7\", \"D7\", \"D#7\", \"E7\", \"F7\", \"F#7\", \"G7\", \"G#7\", \"A7\", \"A#7\", \"B7\", \"C8\", \"C#8\", \"D8\", \"D#8\", \"E8\", \"F8\", \"F#8\", \"G8\", \"G#8\", \"A8\", \"A#8\"] };\r\nlet scoreTable = {\r\n    \"1\": { score: 64, dot: \"\", beat: 0.0625, b64: 1, b16: 0.25 },\r\n    \"2\": { score: 32, dot: \"\", beat: 0.125, b64: 2, b16: 0.5 },\r\n    \"3\": { score: 32, dot: \"d\", beat: 0.1875, b64: 3, b16: 0.75 },\r\n    \"4\": { score: 16, dot: \"\", beat: 0.25, b64: 4, b16: 1 },\r\n    \"6\": { score: 16, dot: \"d\", beat: 0.375, b64: 6, b16: 1.5 },\r\n    \"7\": { score: 16, dot: \"dd\", beat: 0.4375, b64: 7, b16: 1.75 },\r\n    \"8\": { score: 8, dot: \"\", beat: 0.5, b64: 8, b16: 2 },\r\n    \"12\": { score: 8, dot: \"d\", beat: 0.75, b64: 12, b16: 3 },\r\n    \"14\": { score: 8, dot: \"dd\", beat: 0.875, b64: 14, b16: 3.5 },\r\n    \"16\": { score: 4, dot: \"\", beat: 1, b64: 16, b16: 4 },\r\n    \"24\": { score: 4, dot: \"d\", beat: 1.5, b64: 24, b16: 6 },\r\n    \"28\": { score: 4, dot: \"dd\", beat: 1.75, b64: 28, b16: 7 },\r\n    \"32\": { score: 2, dot: \"\", beat: 2, b64: 32, b16: 8 },\r\n    \"48\": { score: 2, dot: \"d\", beat: 3, b64: 48, b16: 12 },\r\n    \"56\": { score: 2, dot: \"dd\", beat: 3.5, b64: 56, b16: 14 },\r\n    \"64\": { score: 1, dot: \"\", beat: 4, b64: 64, b16: 16 },\r\n    \"96\": { score: 1, dot: \"d\", beat: 6, b64: 96, b16: 24 },\r\n    \"112\": { score: 1, dot: \"dd\", beat: 7, b64: 112, b16: 28 }\r\n};\r\nconst sortNote = (notes, desc) => {\r\n    if (desc) {\r\n        return notes.sort((a, b) => noteToMidiMap[b] - noteToMidiMap[a]);\r\n    }\r\n    else {\r\n        return notes.sort((b, a) => noteToMidiMap[b] - noteToMidiMap[a]);\r\n    }\r\n};\r\nconst convertKey = (note, key) => {\r\n    let i = keyMap[\"C\"].indexOf(note);\r\n    return keyMap[key][i];\r\n};\r\nlet dkeyScoreTable = Object.keys(scoreTable).reduce((r, n) => {\r\n    r[scoreTable[n].score + scoreTable[n].dot] = scoreTable[n];\r\n    return r;\r\n}, {});\r\nlet scoreIndex64b = Object.keys(scoreTable).map(n => parseInt(n)).sort((a, b) => -a - b);\r\nlet sil = scoreIndex64b.length;\r\nlet fillRed = { fillStyle: \"red\", strokeStyle: \"red\" };\r\nlet fillBlack = { fillStyle: \"black\", strokeStyle: \"black\" };\r\nfunction checkBarBeat(notes) {\r\n    console.error(\"checkBarBeat\", notes);\r\n    if (!(Array.isArray(notes) && notes.length && notes[0].duration)) {\r\n        throw new Error(\"wrong param\");\r\n    }\r\n    let beatSum1 = 0;\r\n    let beatSum2 = 0;\r\n    notes.forEach(note => {\r\n        beatSum1 += dkeyScoreTable[note.duration.replace(/r/g, '')].b64;\r\n        beatSum2 += note.length;\r\n    });\r\n    console.error(\"beatsum1\", beatSum1);\r\n    console.error(\"beatsum2\", beatSum2);\r\n    if (beatSum1 != beatSum2) {\r\n        return false;\r\n    }\r\n    if (isNaN(beatSum1)) {\r\n        return false;\r\n    }\r\n    return beatSum1 == 16 * 4;\r\n}\r\nfunction b64ToDurations(b64, rest) {\r\n    let r = rest ? \"r\" : \"\";\r\n    return b64Split(b64).map(b => scoreTable[b].score + scoreTable[b].dot + r);\r\n}\r\nfunction b64Split(b64) {\r\n    if (b64 <= 0) {\r\n        throw new Error(\"wrong param\");\r\n    }\r\n    let subCount = -1;\r\n    let duration = [];\r\n    while (1) {\r\n        if (scoreTable[b64]) {\r\n            duration.push(scoreTable[b64].b64);\r\n            if (subCount == -1) {\r\n                break;\r\n            }\r\n            else {\r\n                b64 = subCount;\r\n                subCount = -1;\r\n            }\r\n        }\r\n        else {\r\n            for (let i = 0; i < sil; i++) {\r\n                if (b64 >= scoreIndex64b[i]) {\r\n                    subCount = b64 - scoreIndex64b[i];\r\n                    b64 = scoreIndex64b[i];\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return duration;\r\n}\r\nlet noteParseExp = /^([a-gA-G])([#b]+)?([0-9])$/;\r\nfunction noteToVFFormat(note) {\r\n    let m = note.match(noteParseExp);\r\n    if (m) {\r\n        return {\r\n            note: m[1] + (m[2] || \"\") + '/' + m[3],\r\n            accidental: m[2]\r\n        };\r\n    }\r\n    return null;\r\n}\r\nfunction noteToVFFormat2(notes) {\r\n    let ns = [], ac = [];\r\n    notes.forEach(note => {\r\n        let m = note.match(noteParseExp);\r\n        if (m) {\r\n            ns.push(m[1] + (m[2] || \"\") + '/' + m[3]);\r\n            ac.push(m[2]);\r\n        }\r\n        else {\r\n            ns.push(null);\r\n            ac.push(null);\r\n        }\r\n    });\r\n    return {\r\n        notes: ns,\r\n        accidentals: ac\r\n    };\r\n}\r\nfunction charCount(str, c) {\r\n    var result = 0, i = 0, l = str.length;\r\n    for (i; i < l; i++)\r\n        if (str[i] == c)\r\n            result++;\r\n    return result;\r\n}\r\n;\r\nconst REST_NOTE_KEY = \"c5\";\r\nfunction b64ToDuration(b64, rest) {\r\n    if (scoreTable[b64]) {\r\n        return scoreTable[b64].score + scoreTable[b64].dot + (rest ? \"r\" : \"\");\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n}\r\nfunction makeRestNoteInfoSplitRest(note, offset, length) {\r\n    let subOffset = offset;\r\n    let notes = b64Split(length).map(b => {\r\n        let rn = {\r\n            note: [note || REST_NOTE_KEY],\r\n            b64: subOffset,\r\n            length: b,\r\n            endB64: subOffset + b - 1,\r\n            duration: b64ToDuration(b, true),\r\n            isRest: true,\r\n            fixedRest: !note ? true : false\r\n        };\r\n        subOffset += b;\r\n        return rn;\r\n    });\r\n    if (notes.length > 1) {\r\n        notes[0].tieTail = notes[notes.length - 1];\r\n        notes[notes.length - 1].tieHead = notes[0];\r\n    }\r\n    return notes;\r\n}\r\nfunction createStaveNote(noteInfo, keyDiff) {\r\n    let notes = noteInfo.note;\r\n    if (keyDiff) {\r\n        if (!noteInfo.isRest || !noteInfo.fixedRest) {\r\n            notes = notes.map(note => {\r\n                return convertKey(note, keyDiff);\r\n            });\r\n        }\r\n    }\r\n    let info = noteToVFFormat2(notes);\r\n    let sn = new VF.StaveNote({ keys: info.notes, duration: noteInfo.duration, auto_stem: true });\r\n    if (!noteInfo.isRest) {\r\n        info.accidentals.forEach((ac, i) => {\r\n            if (ac)\r\n                sn.addAccidental(i, new VF.Accidental(ac));\r\n        });\r\n    }\r\n    let l = charCount(noteInfo.duration, 'd');\r\n    for (let i = 0; i < l; i++) {\r\n        sn.addDotToAll();\r\n    }\r\n    return sn;\r\n}\r\nfunction convertToVexFlowData(data) {\r\n    return data.map((tdata, ti) => {\r\n        let line = [];\r\n        tdata.data.forEach((ndata, ni) => {\r\n            if (ndata) {\r\n                let bars = [[], []], note, beat, bi;\r\n                for (note in ndata.data) {\r\n                    for (beat in ndata.data[note]) {\r\n                        bi = Math.floor(parseFloat(beat) / 16);\r\n                        let n = { note: note, b64: Math.round((ni * 32 + parseFloat(beat)) * 4), length: Math.round(ndata.data[note][beat] * 4) };\r\n                        n.endB64 = n.b64 + n.length - 1;\r\n                        bars[bi].push(n);\r\n                    }\r\n                }\r\n                bars.forEach(bar => {\r\n                    bar.sort((a, b) => a.b64 - b.b64);\r\n                });\r\n                line = line.concat(bars);\r\n            }\r\n            else if (ti < tdata.data.length - 1) {\r\n                line.push([], []);\r\n            }\r\n        });\r\n        let notes = line.reduce((r, bar) => r.concat(bar), []);\r\n        notes.sort((a, b) => a.b64 == b.b64 ? a.length - b.length : a.b64 - b.b64);\r\n        let voices = [], voice, p;\r\n        notes.forEach(note => {\r\n            p = 0;\r\n            while (1) {\r\n                if (!voices[p])\r\n                    voices[p] = [];\r\n                voice = voices[p];\r\n                let lastNote = voice.length ? voice[voice.length - 1] : null;\r\n                if (lastNote == null || note.b64 > lastNote.endB64 || (note.b64 == lastNote.b64 && note.length == lastNote.length)) {\r\n                    voice.push(note);\r\n                    break;\r\n                }\r\n                else {\r\n                    p++;\r\n                }\r\n                if (p > 100) {\r\n                    console.error(\"??!!\");\r\n                    break;\r\n                }\r\n            }\r\n        });\r\n        voices.forEach((voice, vi) => voice.forEach(note => note.voiceIndex = vi));\r\n        for (let li = 0; li < line.length; li++) {\r\n            let bar = line[li];\r\n            if (bar.length) {\r\n                line[li] = bar.reduce((r, note) => {\r\n                    if (!r[note.voiceIndex])\r\n                        r[note.voiceIndex] = [];\r\n                    r[note.voiceIndex].push(note);\r\n                    return r;\r\n                }, []);\r\n            }\r\n            else {\r\n                line[li] = [[]];\r\n            }\r\n        }\r\n        line.forEach((bar, li) => {\r\n            bar.forEach(voice => {\r\n                let prevB64, prevLength, tempArr, newVoice;\r\n                newVoice = voice.sort((a, b) => a.b64 == b.b64 ? a.length - b.length : a.b64 - b.b64)\r\n                    .reduce((r, note, i) => {\r\n                    if (note.b64 == prevB64 && note.length == prevLength) {\r\n                        tempArr.push(note.note);\r\n                    }\r\n                    else {\r\n                        prevB64 = note.b64;\r\n                        prevLength = note.length;\r\n                        note.note = [note.note];\r\n                        tempArr = note.note;\r\n                        r.push(note);\r\n                    }\r\n                    return r;\r\n                }, []);\r\n                newVoice.forEach(voice => {\r\n                    if (voice.note.length > 1) {\r\n                        sortNote(voice.note);\r\n                    }\r\n                });\r\n                voice.length = 0;\r\n                voice.push(...newVoice);\r\n            });\r\n        });\r\n        let fb64 = 16 * 4;\r\n        line.forEach((bar, li) => {\r\n            let bars = [bar];\r\n            bar.forEach((voice, vi) => {\r\n                let lastNote = voice[voice.length - 1];\r\n                if (lastNote) {\r\n                    let sliceB64 = (li + 1) * fb64;\r\n                    if (lastNote.endB64 >= sliceB64) {\r\n                        let nextBar, nextVoice;\r\n                        if (li == line.length - 1) {\r\n                            nextVoice = [];\r\n                            nextBar = [nextVoice];\r\n                        }\r\n                        else {\r\n                            nextBar = line[li + 1];\r\n                            if (!nextBar[vi]) {\r\n                                nextVoice = [];\r\n                                nextBar[vi] = nextVoice;\r\n                            }\r\n                            else {\r\n                                nextVoice = nextBar[vi];\r\n                            }\r\n                        }\r\n                        let n = { note: lastNote.note, b64: sliceB64, length: lastNote.endB64 - sliceB64 + 1 };\r\n                        n.endB64 = n.b64 + n.length - 1;\r\n                        n.voiceIndex = lastNote.voiceIndex;\r\n                        nextVoice.unshift(n);\r\n                        lastNote.endB64 = sliceB64 - 1;\r\n                        lastNote.length = lastNote.endB64 - lastNote.b64 + 1;\r\n                        lastNote.tieTail = n;\r\n                        n.tieHead = lastNote;\r\n                        if (li == line.length - 1) {\r\n                            line.push(nextBar);\r\n                            bars.push(nextBar);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            bars.forEach(bar => {\r\n                bar.forEach(voice => {\r\n                    let newVoice = voice.reduce((r, note) => {\r\n                        let b64Offset = note.b64;\r\n                        let notes = b64Split(note.length).map((b, bi, arr) => {\r\n                            let n = Object.assign({}, note);\r\n                            delete n.tieTail;\r\n                            delete n.tieHead;\r\n                            n.b64 = b64Offset;\r\n                            n.length = b;\r\n                            n.endB64 = n.b64 + n.length - 1;\r\n                            b64Offset += b;\r\n                            return n;\r\n                        });\r\n                        if (note.tieHead) {\r\n                            note.tieHead.tieTail = notes[notes.length - 1];\r\n                            notes[notes.length - 1].tieHead = note.tieHead;\r\n                        }\r\n                        else if (note.tieTail) {\r\n                            notes[0].tieTail = note.tieTail;\r\n                            note.tieTail.tieHead = notes[0];\r\n                        }\r\n                        else if (notes.length > 1) {\r\n                            notes[0].tieTail = notes[notes.length - 1];\r\n                            notes[notes.length - 1].tieHead = notes[0];\r\n                        }\r\n                        return r.concat(notes);\r\n                    }, []);\r\n                    voice.length = 0;\r\n                    voice.push(...newVoice);\r\n                });\r\n            });\r\n        });\r\n        line.forEach((bar, li) => {\r\n            let yfix = bar.length == 1;\r\n            bar.forEach(voice => {\r\n                let newVoice;\r\n                let offset = li * fb64;\r\n                let offsetEnd = offset + fb64;\r\n                newVoice = voice.reduce((r, note, i) => {\r\n                    if (note.b64 - offset > 0) {\r\n                        r.push(...makeRestNoteInfoSplitRest(yfix ? null : note.note[0], offset, note.b64 - offset));\r\n                    }\r\n                    note.duration = b64ToDuration(note.length);\r\n                    r.push(note);\r\n                    offset = note.endB64 + 1;\r\n                    return r;\r\n                }, []);\r\n                if (offset < offsetEnd) {\r\n                    if (newVoice.length) {\r\n                        newVoice.push(...makeRestNoteInfoSplitRest(yfix ? null : newVoice[newVoice.length - 1].note[0], offset, offsetEnd - offset));\r\n                    }\r\n                    else {\r\n                        newVoice.push(...makeRestNoteInfoSplitRest(null, li * fb64, fb64));\r\n                    }\r\n                }\r\n                voice.length = 0;\r\n                voice.push(...newVoice);\r\n            });\r\n        });\r\n        return line;\r\n    });\r\n}\r\nfunction drawNotation(vexflowData, options) {\r\n    let { startBarNum, partGap, noteC, bpm, trackLength, topMargin, leftMargin, measureWidth, groupGap } = options;\r\n    let groupYC = 0;\r\n    startBarNum = startBarNum || 1;\r\n    let el = document[\"rootElement\"];\r\n    while (el.firstChild) {\r\n        el.removeChild(el.firstChild);\r\n    }\r\n    let renderer = new VF.Renderer(el, el.tagName == \"CANVAS\" ? VF.Renderer.Backends.CANVAS : VF.Renderer.Backends.SVG);\r\n    let keySignature = \"C\";\r\n    let keyDiff = [];\r\n    let context = renderer.getContext();\r\n    context.setFont(\"Arial\", 10, \"\").setBackgroundFillStyle(\"#eed\");\r\n    vexflowData.forEach((line, li) => {\r\n        line.forEach(bar => {\r\n            bar.forEach(voice => {\r\n                voice.forEach(note => {\r\n                    note.staveNote = createStaveNote(note, keyDiff[li]);\r\n                });\r\n            });\r\n        });\r\n    });\r\n    let voiceMax = 0;\r\n    let barMax = vexflowData[0].length;\r\n    let lineMax = vexflowData.length;\r\n    let beamsList = [];\r\n    let stavesList = [];\r\n    let tiesList = [];\r\n    renderer.resize(measureWidth * 4 + leftMargin + 20, (Math.ceil(barMax / 4) * (lineMax * groupGap + partGap)) + topMargin);\r\n    vexflowData = vexflowData.map((line, li) => {\r\n        let staves = [];\r\n        let ties = [];\r\n        line = line.map(bar => {\r\n            if (bar.length > voiceMax) {\r\n                voiceMax = bar.length;\r\n            }\r\n            return bar.map(voice => {\r\n                let notes = voice.map(note => {\r\n                    if (note.tieTail) {\r\n                        ties.push(new VF.StaveTie({\r\n                            first_note: note.staveNote,\r\n                            last_note: note.tieTail.staveNote,\r\n                            first_indices: [0],\r\n                            last_indices: [0]\r\n                        }));\r\n                    }\r\n                    return note.staveNote;\r\n                });\r\n                return new VF.Voice({ num_beats: 4, beat_value: 4 }).addTickables(notes).setMode(VF.Voice.Mode.SOFT);\r\n            });\r\n        });\r\n        for (let bi = 0; bi < barMax; bi++) {\r\n            let bar = line[bi] || [new VF.Voice({ num_beats: 4, beat_value: 4 }).addTickables([new VF.StaveNote({ keys: [\"a/4\"], duration: \"1r\" })])];\r\n            let stave = new VF.Stave((bi % 4) * measureWidth + leftMargin, (Math.floor(bi / 4) * (lineMax * groupGap + partGap)) + (li * groupGap) + topMargin, measureWidth);\r\n            staves.push(stave);\r\n            if (bi % 4 == 0) {\r\n                if (li % 2 == 0)\r\n                    stave.addClef(\"treble\");\r\n                else\r\n                    stave.addClef(\"bass\");\r\n                stave.addKeySignature(keySignature);\r\n                if (bi == 0)\r\n                    stave.addTimeSignature(\"4/4\");\r\n                if (li == 0) {\r\n                    stave.setText(bi + startBarNum, VF.StaveModifier.Position.LEFT, {\r\n                        shift_x: -15,\r\n                        shift_y: -40\r\n                    });\r\n                    stave._isStartMeasure = true;\r\n                }\r\n            }\r\n            if (li == 0 && bi == 0) {\r\n                stave.setTempo({ duration: '4', bpm: bpm }, -20);\r\n            }\r\n            stave.setContext(context).draw();\r\n            bar.forEach(voice => {\r\n                beamsList.push(VF.Beam.applyAndGetBeams(voice));\r\n            });\r\n            new VF.Formatter()\r\n                .joinVoices(bar)\r\n                .formatToStave(bar, stave);\r\n            bar.forEach((voice, vi) => {\r\n                voice.draw(context, stave);\r\n            });\r\n        }\r\n        ties.forEach(t => t.setContext(context).draw());\r\n        stavesList.push(staves);\r\n        tiesList.push(ties);\r\n        return line;\r\n    });\r\n    let connectorList = [];\r\n    if (lineMax > 1) {\r\n        for (let i = 0; i < barMax; i += 4) {\r\n            let sc = new VF.StaveConnector(stavesList[0][i], stavesList[lineMax - 1][i]);\r\n            sc.setType(VF.StaveConnector.type.BRACE);\r\n            sc.setContext(context).draw();\r\n        }\r\n    }\r\n    beamsList.forEach(beams => beams.forEach(beam => beam.setContext(context).draw()));\r\n    function redraw() {\r\n        let i, j;\r\n        context.clear();\r\n        for (i = 0; i < stavesList.length; i++) {\r\n            for (j = 0; j < stavesList[i].length; j++) {\r\n                stavesList[i][j].draw();\r\n            }\r\n        }\r\n        for (i = 0; i < connectorList.length; i++) {\r\n            for (j = 0; j < connectorList[i].length; j++) {\r\n                connectorList[i][j].draw();\r\n            }\r\n        }\r\n        vexflowData.forEach(line => {\r\n            line.forEach(bar => {\r\n                bar.forEach(voice => voice.draw(context));\r\n            });\r\n        });\r\n        for (i = 0; i < tiesList.length; i++) {\r\n            for (j = 0; j < tiesList[i].length; j++) {\r\n                tiesList[i][j].draw();\r\n            }\r\n        }\r\n        for (i = 0; i < beamsList.length; i++) {\r\n            for (j = 0; j < beamsList[i].length; j++) {\r\n                beamsList[i][j].draw();\r\n            }\r\n        }\r\n    }\r\n    return {\r\n        renderer: renderer,\r\n        context: context,\r\n        stavesList: stavesList,\r\n        connectorList: connectorList,\r\n        tiesList: tiesList,\r\n        beamsList: beamsList,\r\n        voiceList: vexflowData,\r\n        redraw: redraw\r\n    };\r\n}\r\nfunction clearDrawNote(staveNote) {\r\n    if (staveNote._el && staveNote._el.parentElement) {\r\n        staveNote._el.parentElement.removeChild(staveNote._el);\r\n        staveNote._el = null;\r\n    }\r\n}\r\nfunction drawNote(staveNote, style) {\r\n    clearDrawNote(staveNote);\r\n    staveNote._el = staveNote.context.openGroup('stavenote-highlight', staveNote.getAttribute('id'));\r\n    staveNote.setStyle(style);\r\n    staveNote.context.openGroup('note', null, { pointerBBox: false });\r\n    if (staveNote.hasStem() && !staveNote.beam) {\r\n        staveNote.drawStem();\r\n        if (staveNote.flag) {\r\n            staveNote.flag.setStyle(style);\r\n            staveNote.drawFlag();\r\n        }\r\n    }\r\n    staveNote.drawNoteHeads();\r\n    staveNote.context.closeGroup();\r\n    staveNote.drawModifiers();\r\n    staveNote.context.closeGroup();\r\n}\r\nfunction clearDrawBeam(staveNote) {\r\n    if (staveNote.beam) {\r\n        if (staveNote.beam._el && staveNote.beam._el.parentElement) {\r\n            staveNote.beam._el.parentElement.removeChild(staveNote.beam._el);\r\n            staveNote.beam._el = null;\r\n        }\r\n    }\r\n}\r\nfunction drawBeam(staveNote, style) {\r\n    if (staveNote.beam) {\r\n        clearDrawBeam(staveNote);\r\n        staveNote.beam._el = staveNote.context.openGroup('beam');\r\n        staveNote.context.setFillStyle(style.fillStyle);\r\n        staveNote.context.setStrokeStyle(\"none\");\r\n        staveNote.beam.drawBeamLines();\r\n        staveNote.context.closeGroup();\r\n    }\r\n}\r\nfunction clearDrawBeamStem(staveNote) {\r\n    if (staveNote._beamStem_el && staveNote._beamStem_el.parentElement) {\r\n        staveNote._beamStem_el.parentElement.removeChild(staveNote._beamStem_el);\r\n        staveNote._beamStem_el = null;\r\n    }\r\n}\r\nfunction drawBeamStem(staveNote, style) {\r\n    if (staveNote.beam && staveNote.hasStem()) {\r\n        clearDrawBeamStem(staveNote);\r\n        staveNote._beamStem_el = staveNote.context.openGroup('beam-stem');\r\n        staveNote.stem.setStyle(style);\r\n        staveNote.stem.draw();\r\n        staveNote.context.closeGroup();\r\n    }\r\n}\r\nfunction drawNoteOn(staveNote, just) {\r\n    drawNote(staveNote, fillRed);\r\n    if (staveNote.beam) {\r\n        if (just || staveNote.beam.notes[0] === staveNote) {\r\n            drawBeam(staveNote, fillRed);\r\n            staveNote.beam._highlighted = true;\r\n        }\r\n        drawBeamStem(staveNote, fillRed);\r\n    }\r\n}\r\nfunction drawNoteOff(staveNote, just) {\r\n    clearDrawNote(staveNote);\r\n    if (staveNote.beam) {\r\n        clearDrawBeamStem(staveNote);\r\n        if (just || staveNote.beam.notes[staveNote.beam.notes.length - 1] === staveNote) {\r\n            clearDrawBeam(staveNote);\r\n            staveNote.beam._highlighted = false;\r\n        }\r\n    }\r\n}\r\nlet noteOnList = {};\r\nfunction clearNoteOnList() {\r\n    for (let i in noteOnList) {\r\n        if (noteOnList[i].isOn) {\r\n            noteOff(noteOnList[i], true);\r\n        }\r\n        delete noteOnList[i];\r\n    }\r\n}\r\nfunction noteOn(note) {\r\n    if (!note.isOn) {\r\n        for (let i in noteOnList) {\r\n            if (noteOnList[i].endB64 < note.b64) {\r\n                if (noteOnList[i].isOn) {\r\n                    noteOff(noteOnList[i], true);\r\n                }\r\n                delete noteOnList[i];\r\n            }\r\n        }\r\n        noteOnList[note.id] = note;\r\n        try {\r\n            drawNoteOn(note.staveNote);\r\n            note.isOn = true;\r\n        }\r\n        catch (e) {\r\n            console.error(note, e);\r\n        }\r\n    }\r\n}\r\nfunction noteOff(note, just) {\r\n    if (note.isOn || (just && note.staveNote.beam && note.staveNote.beam._highlighted)) {\r\n        delete noteOnList[note.id];\r\n        drawNoteOff(note.staveNote, just);\r\n        note.isOn = false;\r\n    }\r\n}\r\nlet t64;\r\nlet defaultDrawOption = {\r\n    topMargin: 80,\r\n    leftMargin: 50,\r\n    measureWidth: 299,\r\n    groupGap: 140,\r\n    partGap: 70\r\n};\r\nfunction create(data, options) {\r\n    console.error(\"data\", data);\r\n    let lineList = convertToVexFlowData(data.data);\r\n    options = Object.assign({}, defaultDrawOption, options);\r\n    options.bpm = data.bpm;\r\n    options.noteC = data.nodeLength * 2;\r\n    options.trackLength = data.data.length;\r\n    let ctx = drawNotation(lineList, options).context;\r\n    t64 = Tone.Time(\"64n\").toSeconds();\r\n    let sync = createSync({ scrollContainer: options.scroll ? document[\"rootElement\"] : null });\r\n    sync.setContext(ctx);\r\n    sync.setLineList(lineList);\r\n    return sync;\r\n}\r\nlet scrollOffset = 0;\r\nlet scrollDuration = 500;\r\nfunction scrollToStave(con, staveY) {\r\n    if ((con.scrollTop > staveY - scrollOffset || con.scrollTop <= staveY - scrollOffset - (window.innerHeight - 500))) {\r\n        con.scrollTo(0, staveY - scrollOffset);\r\n    }\r\n}\r\nfunction createSync(opt) {\r\n    opt = opt || {};\r\n    let startNote, currentStave;\r\n    let isScrolling = !!opt.scrollContainer;\r\n    let part = new Tone.Part((time, note) => {\r\n        Tone.Draw.schedule(() => {\r\n            if (!part._stopped) {\r\n                if (startNote) {\r\n                    if (startNote === note) {\r\n                        startNote = null;\r\n                        clearNoteOnList();\r\n                    }\r\n                    else {\r\n                        return;\r\n                    }\r\n                }\r\n                noteOn(note);\r\n                if (isScrolling && note.staveNote.stave && note.staveNote.stave._isStartMeasure && currentStave != note.staveNote.stave) {\r\n                    scrollToStave(opt.scrollContainer, note.staveNote.stave.y);\r\n                    currentStave = note.staveNote.stave;\r\n                }\r\n            }\r\n        }, time);\r\n    });\r\n    part._stopped = true;\r\n    let offPart = new Tone.Part((time, note) => {\r\n        Tone.Draw.schedule(() => {\r\n            if (!part._stopped) {\r\n                noteOff(note);\r\n            }\r\n        }, time);\r\n    });\r\n    let notes = [];\r\n    function setLineList(list) {\r\n        part.removeAll();\r\n        offPart.removeAll();\r\n        list.forEach(line => {\r\n            line.forEach(bar => {\r\n                bar.forEach(voice => {\r\n                    voice.forEach(note => {\r\n                        part.add(note.b64 * t64, note);\r\n                        offPart.add(note.endB64 * t64, note);\r\n                        note.id = '' + Date.now() + Math.round(Math.random() * 10000);\r\n                        notes.push(note);\r\n                        notes[note.id] = note;\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    }\r\n    return {\r\n        notes: notes,\r\n        part: part,\r\n        offPart: offPart,\r\n        start: function () {\r\n            startNote = this.part.at(0).value;\r\n            this.part._stopped = false;\r\n            this.part.start(\"+0.1\");\r\n            this.offPart.start(\"+0.1\");\r\n        },\r\n        stop: function () {\r\n            startNote = null;\r\n            this.part._stopped = true;\r\n            this.part.stop();\r\n            this.offPart.stop();\r\n            Tone.Draw.cancel();\r\n            this.clear();\r\n        },\r\n        clear: function () {\r\n            notes.forEach(note => noteOff(note, true));\r\n        },\r\n        setLineList: setLineList,\r\n        setContext: function (ctx) {\r\n            this.ctx = ctx;\r\n        }\r\n    };\r\n}\r\nvar loader = (function () {\r\n    var i = 0, max, list, each, done;\r\n    function start(_list, _each, _done) {\r\n        i = 0;\r\n        max = _list.length;\r\n        list = _list;\r\n        if (_done) {\r\n            each = _each;\r\n            done = _done;\r\n        }\r\n        else {\r\n            each = null;\r\n            done = _each;\r\n        }\r\n        load(list[i]);\r\n    }\r\n    function load(src) {\r\n        if (i >= max) {\r\n            console.error(\"over index\");\r\n            return;\r\n        }\r\n        console.error(\"load script:\", src);\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", src, true);\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4) {\r\n                if (xhr.status == 200) {\r\n                    eval(xhr.responseText);\r\n                    loadComplete();\r\n                }\r\n                else {\r\n                    console.error(\": \", xhr.status);\r\n                }\r\n            }\r\n        };\r\n        xhr.send(null);\r\n    }\r\n    function loadComplete() {\r\n        if (++i < max) {\r\n            if (each) {\r\n                each(i - 1);\r\n            }\r\n            load(list[i]);\r\n        }\r\n        else {\r\n            console.error(\"load complete\");\r\n            if (done)\r\n                done();\r\n        }\r\n    }\r\n    return {\r\n        load: start\r\n    };\r\n})();\r\nexport function loadAndInit(data, opt) {\r\n    console.error(\"loadAndInit\", version);\r\n    load(function () {\r\n        init(data, opt);\r\n    });\r\n}\r\nexport function load(done) {\r\n    var scripts = [\r\n        \"https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js\",\r\n        \"https://cdnjs.cloudflare.com/ajax/libs/tone/13.8.10/Tone.min.js\",\r\n        \"https://cdnjs.cloudflare.com/ajax/libs/vexflow/1.2.89/vexflow-min.js\",\r\n        \"https://cdn.jsdelivr.net/npm/soundfont-player@0.11.0/dist/soundfont-player.min.js\"\r\n    ];\r\n    loader.load(scripts, function (i) {\r\n        msg(\" (\" + i + \")\");\r\n    }, done);\r\n}\r\nvar version = \"0.17\";\r\nvar ns = \"http://www.w3.org/2000/svg\";\r\nvar progressText;\r\nfunction createNSElement(tagName, attr, parant) {\r\n    var el = document.createElementNS(ns, tagName);\r\n    if (attr) {\r\n        for (var o in attr) {\r\n            el.setAttribute(o, attr[o]);\r\n        }\r\n    }\r\n    (parant || document[\"rootElement\"]).appendChild(el);\r\n    return el;\r\n}\r\nexport function msg(str) {\r\n    if (!progressText)\r\n        progressText = createNSElement(\"text\", { x: 100, y: 18, fill: \"#000\" });\r\n    setTimeout(function () {\r\n        console.info(\"progress:\", str);\r\n        progressText.textContent = \"v\" + version + \" \" + str;\r\n    });\r\n}\r\nexport function init(data, opt) {\r\n    VF = Vex.Flow;\r\n    console.error(\"start tone setting\");\r\n    Tone.Transport.bpm.value = data.bpm;\r\n    var synth, playData, totalTime, parts, btn, highlight;\r\n    msg(\" ...\");\r\n    Soundfont.instrument(Tone.context._context, 'acoustic_grand_piano').then(function (piano) {\r\n        console.error(\"instrument loaded\");\r\n        synth = piano;\r\n        msg(\" ...\");\r\n        opt = opt || {};\r\n        opt.scroll = true;\r\n        highlight = create(data, opt);\r\n        document[\"rootElement\"].appendChild(progressText);\r\n        ready();\r\n    });\r\n    function createPlayBtn(callback) {\r\n        var g = createNSElement(\"g\", { x: 10, y: 10 });\r\n        var btn = createNSElement(\"rect\", {\r\n            width: 70,\r\n            height: 20,\r\n            x: 10,\r\n            y: 5\r\n        }, g);\r\n        var txt = createNSElement(\"text\", {\r\n            x: 10,\r\n            y: 20\r\n        }, g);\r\n        txt.textContent = \"/\";\r\n        txt.setAttribute(\"pointer-events\", \"none\");\r\n        g.btn = btn;\r\n        g.addEventListener(\"click\", callback);\r\n        g.setColor = function (color) {\r\n            btn.style.fill = color;\r\n        };\r\n        g.activeColor = function () {\r\n            btn.style.fill = \"rgb(53, 236, 31)\";\r\n        };\r\n        g.deactiveColor = function () {\r\n            btn.style.fill = \"rgb(238, 51, 25)\";\r\n        };\r\n        return g;\r\n    }\r\n    function getTotalTime(playData) {\r\n        var max = 0;\r\n        playData.forEach(function (events) {\r\n            var last = events[events.length - 1];\r\n            var maxDu = 0;\r\n            last[1].durations.forEach(function (d) {\r\n                if (d > maxDu) {\r\n                    maxDu = d;\r\n                }\r\n            });\r\n            if (last[0] + maxDu > max) {\r\n                max = last[0] + maxDu;\r\n            }\r\n        });\r\n        return max;\r\n    }\r\n    var isReady;\r\n    function tick(noteInfo, time) {\r\n        noteInfo.notes.forEach(function (note, i) {\r\n            synth.play(note, time, noteInfo.durations[i]);\r\n        });\r\n    }\r\n    function ready() {\r\n        console.error(\"ready\");\r\n        msg(\"  ...\");\r\n        playData = createPlayData(data);\r\n        totalTime = getTotalTime(playData);\r\n        console.error(\"totalTime\", totalTime);\r\n        msg(\" ...\");\r\n        parts = schedule(playData, tick);\r\n        isReady = true;\r\n        msg(\" !\");\r\n        btn = createPlayBtn(play);\r\n        btn.activeColor();\r\n    }\r\n    function stop() {\r\n        if (!isReady)\r\n            return;\r\n        if (btn)\r\n            btn.activeColor();\r\n        console.error(\"stop\");\r\n        highlight.stop();\r\n        parts.forEach(part => part.stop());\r\n        Tone.Transport.stop();\r\n        Tone.Transport.clear(endScheduleId);\r\n    }\r\n    var endScheduleId;\r\n    function play() {\r\n        if (!isReady)\r\n            return;\r\n        if (Tone.Transport.state == \"started\") {\r\n            stop();\r\n        }\r\n        else {\r\n            stop();\r\n            console.error(\"play\");\r\n            if (btn)\r\n                btn.deactiveColor();\r\n            parts.forEach(part => {\r\n                part.start(\"+0.1\");\r\n            });\r\n            highlight.start();\r\n            endScheduleId = Tone.Transport.schedule(function (time) {\r\n                stop();\r\n            }, \"+\" + (totalTime + 0.5));\r\n            Tone.Transport.start(\"+0.5\");\r\n        }\r\n    }\r\n}\r\n"],"sourceRoot":""}